# CLAUDE.md
# Dashboard-Light: EKS Мониторинг и Визуализация

## Обзор проекта

Dashboard-Light - это веб-приложение для мониторинга и визуализации состояния Deployments и Pods в кластерах AWS EKS в режиме реального времени. Проект разрабатывается с использованием функционального подхода к программированию на Python.

## История проекта

Изначально проект начинался как Clojure-приложение, но был перенесен на Python для ускорения разработки и упрощения отладки, сохраняя при этом функциональный стиль программирования. Это позволяет сосредоточиться на бизнес-логике и функциональности, а не на преодолении трудностей, связанных с изучением нового языка.

## Функциональный подход в Python

Проект придерживается следующих принципов функционального программирования:

- **Чистые функции**: Функции не имеют побочных эффектов и возвращают одинаковые результаты для одинаковых входных данных
- **Иммутабельность**: Предпочтение отдается неизменяемым структурам данных
- **Композиция функций**: Использование функций высшего порядка и композиции для создания более сложной логики
- **Декларативный стиль**: Описание того, что должно быть сделано, а не как это сделать

## Структура проекта

Проект организован в модульную структуру, где каждый модуль отвечает за определенную часть функциональности:

```
dashboard-light/
├── pyproject.toml              # Конфигурация проекта
├── src/dashboard_light/        # Основной код
│   ├── core.py                 # Точка входа в приложение
│   ├── config/                 # Работа с конфигурацией
│   ├── auth/                   # Аутентификация и авторизация
│   ├── k8s/                    # Взаимодействие с Kubernetes API
│   ├── web/                    # Веб-интерфейс и API
│   ├── ui/                     # UI логика
│   └── utils/                  # Вспомогательные функции
├── resources/                  # Ресурсы проекта
├── tests/                      # Тесты
```

## Ключевые компоненты

### Конфигурация (config)

Модуль для загрузки и валидации конфигурации из YAML-файла с поддержкой переменных окружения.

### Kubernetes API (k8s)

Взаимодействие с Kubernetes API для получения информации о Deployments, Pods и других ресурсах.

### Аутентификация (auth)

Интеграция с GitLab OAuth для аутентификации пользователей и управления доступом на основе групп GitLab.

### Веб-интерфейс (web)

FastAPI-приложение для обработки HTTP-запросов и отдачи статического контента.

### UI логика (ui)

Функции для управления состоянием пользовательского интерфейса, включая режимы фокуса и сравнения Deployments.

### Утилиты (utils)

Общие функции и инструменты для работы с данными, логирования и других задач.

## Особенности реализации

- **Кэширование**: Результаты запросов к Kubernetes API кэшируются для снижения нагрузки на кластер
- **RBAC**: Тонкая настройка прав доступа на основе ролей пользователей
- **Мониторинг в реальном времени**: Автоматическое обновление данных без перезагрузки страницы
- **Темная/светлая тема**: Поддержка разных цветовых схем интерфейса

## Разработка

Разработка ведется в Emacs с использованием org-babel, что позволяет:
- Документировать код прямо в org-файлах
- Тестировать код в интерактивном режиме
- Экспортировать код в файлы проекта (tangle)

## Дальнейшие планы

- Реализация полного функционала из ТЗ
- Добавление тестов для ключевых компонентов
- Создание дистрибутива для деплоя в кластер EKS
- Расширение функциональности для мониторинга других ресурсов Kubernetes

## Команды для работы с проектом

Для запуска проекта:
```bash
python -m dashboard_light.core
```

Для запуска в режиме разработки:
```bash
K8S_MOCK=true DISABLE_AUTH=true python -m dashboard_light.core
```

Для запуска тестов:
```bash
pytest tests/
```
